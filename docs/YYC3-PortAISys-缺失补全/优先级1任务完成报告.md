# YYCÂ³ æ–‡æ¡£åŒæ­¥å·¥å…· - ä¼˜å…ˆçº§1ä»»åŠ¡å®ŒæˆæŠ¥å‘Š

## ğŸ“‹ å·¥ä½œæ¦‚è§ˆ

**å·¥ä½œæ—¥æœŸ**: 2026-01-20  
**å·¥ä½œå†…å®¹**: ç”¨æˆ·è®¤è¯ç³»ç»Ÿå®ç°ä¸ä¼˜åŒ–ç‰ˆåŒæ­¥è§¦å‘å™¨é›†æˆ  
**æ‰§è¡Œäººå‘˜**: YYCÂ³ AI Team  
**å·¥ä½œçŠ¶æ€**: âœ… ä¼˜å…ˆçº§1ä»»åŠ¡å·²å…¨éƒ¨å®Œæˆ

---

## ğŸ¯ å®Œæˆä»»åŠ¡

### ä¸€ã€ç”¨æˆ·è®¤è¯ç³»ç»Ÿå®ç° âœ…

#### 1.1 NextAuth.jsé›†æˆ âœ…

**å®Œæˆå†…å®¹**:
- é›†æˆNextAuth.js v5ï¼ˆbetaç‰ˆæœ¬ï¼‰
- é…ç½®Credentials Provider
- å®ç°JWTä¼šè¯ç­–ç•¥
- é…ç½®Prisma Adapter
- å®ç°å¯†ç åŠ å¯†å’ŒéªŒè¯

**äº¤ä»˜æˆæœ**:
- [src/lib/auth.ts](file:///Users/my/yyc3-Portable-Intelligent-AI-System/web-dashboard/src/lib/auth.ts) - NextAuthé…ç½®
- [src/lib/password.ts](file:///Users/my/yyc3-Portable-Intelligent-AI-System/web-dashboard/src/lib/password.ts) - å¯†ç å·¥å…·å‡½æ•°
- [src/types/next-auth.d.ts](file:///Users/my/yyc3-Portable-Intelligent-AI-System/web-dashboard/src/types/next-auth.d.ts) - TypeScriptç±»å‹å®šä¹‰

**æ ¸å¿ƒåŠŸèƒ½**:
```typescript
// è®¤è¯é…ç½®
export const { handlers, signIn, signOut, auth } = NextAuth({
  adapter: PrismaAdapter(prisma),
  providers: [CredentialsProvider],
  session: { strategy: 'jwt' },
  callbacks: {
    async jwt({ token, user }) {
      if (user) token.role = user.role
      return token
    },
    async session({ session, token }) {
      if (token) {
        session.user.id = token.sub!
        session.user.role = token.role
      }
      return session
    }
  }
})
```

**å¯†ç å®‰å…¨**:
- ä½¿ç”¨bcryptjsè¿›è¡Œå¯†ç åŠ å¯†
- å®ç°å¯†ç å¼ºåº¦éªŒè¯
- æ”¯æŒå¯†ç é‡ç½®ï¼ˆå¾…å®ç°ï¼‰

#### 1.2 ç™»å½•é¡µé¢ âœ…

**å®Œæˆå†…å®¹**:
- åˆ›å»ºå“åº”å¼ç™»å½•é¡µé¢
- å®ç°è¡¨å•éªŒè¯
- å®ç°é”™è¯¯æç¤º
- é›†æˆNextAuth.jsè®¤è¯
- æ·»åŠ ç™»å½•/æ³¨å†Œé“¾æ¥

**äº¤ä»˜æˆæœ**:
- [src/app/auth/signin/page.tsx](file:///Users/my/yyc3-Portable-Intelligent-AI-System/web-dashboard/src/app/auth/signin/page.tsx) - ç™»å½•é¡µé¢

**UIç‰¹æ€§**:
- æ¸å˜èƒŒæ™¯è®¾è®¡
- é‚®ç®±å’Œå¯†ç è¾“å…¥æ¡†
- å®æ—¶è¡¨å•éªŒè¯
- é”™è¯¯æç¤ºæ˜¾ç¤º
- å“åº”å¼å¸ƒå±€

#### 1.3 æ³¨å†Œé¡µé¢ âœ…

**å®Œæˆå†…å®¹**:
- åˆ›å»ºç”¨æˆ·æ³¨å†Œé¡µé¢
- å®ç°è¡¨å•éªŒè¯
- å®ç°å¯†ç ç¡®è®¤
- é›†æˆæ³¨å†ŒAPI
- æ·»åŠ æ³¨å†ŒæˆåŠŸæç¤º

**äº¤ä»˜æˆæœ**:
- [src/app/auth/signup/page.tsx](file:///Users/yyc3-Portable-Intelligent-AI-System/web-dashboard/src/app/auth/signup/page.tsx) - æ³¨å†Œé¡µé¢
- [src/app/api/auth/signup/route.ts](file:///Users/my/yyc3-Portable-Intelligent-AI-System/web-dashboard/src/app/api/auth/signup/route.ts) - æ³¨å†ŒAPI

**æ³¨å†Œæµç¨‹**:
1. ç”¨æˆ·å¡«å†™æ³¨å†Œä¿¡æ¯ï¼ˆç”¨æˆ·åã€é‚®ç®±ã€å¯†ç ã€ç¡®è®¤å¯†ç ï¼‰
2. å‰ç«¯éªŒè¯é‚®ç®±æ ¼å¼å’Œå¯†ç å¼ºåº¦
3. æäº¤åˆ°åç«¯API
4. åç«¯éªŒè¯é‚®ç®±æ˜¯å¦å·²æ³¨å†Œ
5. åŠ å¯†å¯†ç å¹¶ä¿å­˜åˆ°æ•°æ®åº“
6. è¿”å›æ³¨å†ŒæˆåŠŸæç¤º
7. è‡ªåŠ¨è·³è½¬åˆ°ç™»å½•é¡µé¢

#### 1.4 APIè·¯ç”± âœ…

**å®Œæˆå†…å®¹**:
- åˆ›å»ºNextAuth.js APIè·¯ç”±
- åˆ›å»ºç”¨æˆ·æ³¨å†ŒAPI
- å®ç°è¯·æ±‚éªŒè¯
- å®ç°é”™è¯¯å¤„ç†

**äº¤ä»˜æˆæœ**:
- [src/app/api/auth/[...nextauth]/route.ts](file:///Users/my/yyc3-Portable-Intelligent-AI-System/web-dashboard/src/app/api/auth/[...nextauth]/route.ts) - NextAuth API
- [src/app/api/auth/signup/route.ts](file:///Users/my/yyc3-Portable-Intelligent-AI-System/web-dashboard/src/app/api/auth/signup/route.ts) - æ³¨å†ŒAPI

**APIç‰¹æ€§**:
- ä½¿ç”¨Zodè¿›è¡Œè¯·æ±‚éªŒè¯
- å®ç°å¯†ç åŠ å¯†
- æ£€æŸ¥é‚®ç®±é‡å¤
- è¿”å›è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯

#### 1.5 ä¾§è¾¹æ é›†æˆ âœ…

**å®Œæˆå†…å®¹**:
- é›†æˆNextAuth.js Session Provider
- æ˜¾ç¤ºå½“å‰ç”¨æˆ·ä¿¡æ¯
- å®ç°ç™»å‡ºåŠŸèƒ½
- æ·»åŠ ç™»å½•æŒ‰é’®ï¼ˆæœªç™»å½•æ—¶ï¼‰

**äº¤ä»˜æˆæœ**:
- [src/components/auth-provider.tsx](file:///Users/my/yyc3-Portable-Intelligent-AI-System/web-dashboard/src/components/auth-provider.tsx) - Session Provider
- [src/components/sidebar.tsx](file:///Users/my/yyc3-Portable-Intelligent-AI-System/web-dashboard/src/components/sidebar.tsx) - ä¾§è¾¹æ ï¼ˆå·²æ›´æ–°ï¼‰
- [src/app/layout.tsx](file:///Users/my/yyc3-Portable-Intelligent-AI-System/web-dashboard/src/app/layout.tsx) - æ ¹å¸ƒå±€ï¼ˆå·²æ›´æ–°ï¼‰

**ç”¨æˆ·ç•Œé¢**:
- æ˜¾ç¤ºç”¨æˆ·å¤´åƒå’Œåç§°
- æ˜¾ç¤ºç”¨æˆ·é‚®ç®±
- ç™»å‡ºæŒ‰é’®
- æœªç™»å½•æ—¶æ˜¾ç¤ºç™»å½•æŒ‰é’®

---

### äºŒã€ä¼˜åŒ–ç‰ˆåŒæ­¥è§¦å‘å™¨é›†æˆ âœ…

#### 2.1 ä¸»ç¨‹åºé›†æˆ âœ…

**å®Œæˆå†…å®¹**:
- å¯¼å…¥OptimizedBidirectionalSyncTriggerç±»
- æ·»åŠ --optimizedå‘½ä»¤è¡Œé€‰é¡¹
- å®ç°è§¦å‘å™¨ç±»é€‰æ‹©é€»è¾‘
- æ·»åŠ ä¼˜åŒ–åŠŸèƒ½æç¤º

**äº¤ä»˜æˆæœ**:
- [src/index.ts](file:///Users/my/yyc3-Portable-Intelligent-AI-System/tools/doc-code-sync/src/index.ts) - ä¸»ç¨‹åºï¼ˆå·²æ›´æ–°ï¼‰

**ä½¿ç”¨æ–¹å¼**:
```bash
# ä½¿ç”¨æ ‡å‡†ç‰ˆåŒæ­¥è§¦å‘å™¨
yyc3-doc-sync watch

# ä½¿ç”¨ä¼˜åŒ–ç‰ˆåŒæ­¥è§¦å‘å™¨
yyc3-doc-sync watch --optimized
```

**ä¼˜åŒ–åŠŸèƒ½æç¤º**:
```
âœ… å·²å¯ç”¨ä¼˜åŒ–ç‰ˆåŒæ­¥è§¦å‘å™¨
   - åˆ†å—å¤„ç†: å¯ç”¨
   - äºŒçº§ç¼“å­˜: å¯ç”¨
   - å¹¶å‘å¤„ç†: å¯ç”¨
```

#### 2.2 ç±»å‹é”™è¯¯ä¿®å¤ âœ…

**å®Œæˆå†…å®¹**:
- ä¿®å¤chunk-processor.tsä¸­çš„ç±»å‹é”™è¯¯
- ä¿®å¤concurrent-manager.tsä¸­çš„ç±»å‹é”™è¯¯
- ä¿®å¤optimized-sync-trigger.tsä¸­çš„ç±»å‹é”™è¯¯
- æ·»åŠ AggregateErrorç±»å®šä¹‰

**ä¿®å¤çš„é”™è¯¯**:
1. chunk-processor.ts:39 - Bufferç±»å‹å¤„ç†
2. chunk-processor.ts:85 - é”™è¯¯ç±»å‹å®šä¹‰
3. chunk-processor.ts:150 - å¯é€‰ç±»å‹å¤„ç†
4. concurrent-manager.ts:29 - Workerç±»å‹å®šä¹‰
5. concurrent-manager.ts:115 - Workerå¯¼å…¥
6. concurrent-manager.ts:257 - AggregateErrorå®šä¹‰
7. optimized-sync-trigger.ts:138,149,217,254 - timestampç±»å‹è½¬æ¢
8. optimized-sync-trigger.ts:219,256 - detailsç±»å‹ä¿®å¤

**ç¼–è¯‘ç»“æœ**: âœ… æˆåŠŸç¼–è¯‘ï¼Œæ— é”™è¯¯

#### 2.3 æ€§èƒ½ä¼˜åŒ–ç»„ä»¶ âœ…

**å·²é›†æˆçš„ä¼˜åŒ–ç»„ä»¶**:

1. **åˆ†å—å¤„ç†å™¨ (ChunkProcessor)**
   - æ–‡ä»¶åˆ†å—è¯»å–å’Œå†™å…¥
   - æµå¼å¤„ç†å¤§æ–‡ä»¶
   - æ ¡éªŒå’ŒéªŒè¯
   - è¿›åº¦å›è°ƒ

2. **ç¼“å­˜ç®¡ç†å™¨ (CacheManager & MultiLevelCache)**
   - LRUç¼“å­˜æ·˜æ±°ç­–ç•¥
   - TTLè¿‡æœŸæœºåˆ¶
   - äºŒçº§ç¼“å­˜ï¼ˆL1 + L2ï¼‰
   - ç¼“å­˜ç»Ÿè®¡

3. **å¹¶å‘ä»»åŠ¡ç®¡ç†å™¨ (ConcurrentTaskManager)**
   - Workerçº¿ç¨‹æ± ç®¡ç†
   - ä»»åŠ¡ä¼˜å…ˆçº§è°ƒåº¦
   - è‡ªåŠ¨é‡è¯•æœºåˆ¶
   - è¶…æ—¶æ§åˆ¶

4. **ä¼˜åŒ–ç‰ˆåŒæ­¥è§¦å‘å™¨ (OptimizedBidirectionalSyncTrigger)**
   - é›†æˆæ‰€æœ‰ä¼˜åŒ–ç»„ä»¶
   - å®æ—¶è¿›åº¦ç›‘æ§
   - æ€§èƒ½ç»Ÿè®¡æŠ¥å‘Š
   - äº‹ä»¶é©±åŠ¨æ¶æ„

---

## ğŸ“Š æŠ€æœ¯å®ç°ç»†èŠ‚

### NextAuth.jsé…ç½®

```typescript
// src/lib/auth.ts
import NextAuth from 'next-auth'
import { PrismaAdapter } from '@next-auth/prisma-adapter'
import CredentialsProvider from 'next-auth/providers/credentials'

export const { handlers, signIn, signOut, auth } = NextAuth({
  adapter: PrismaAdapter(prisma),
  providers: [
    CredentialsProvider({
      name: 'credentials',
      credentials: {
        email: { label: 'é‚®ç®±', type: 'email' },
        password: { label: 'å¯†ç ', type: 'password' },
      },
      async authorize(credentials) {
        const user = await prisma.user.findUnique({
          where: { email: credentials?.email }
        })
        
        if (user && await verifyPassword(credentials?.password!, user.password)) {
          return {
            id: user.id,
            email: user.email,
            name: user.name,
            role: user.role,
          }
        }
        return null
      },
    }),
  ],
  session: { strategy: 'jwt' },
  callbacks: {
    async jwt({ token, user }) {
      if (user) token.role = user.role
      return token
    },
    async session({ session, token }) {
      session.user.id = token.sub!
      session.user.role = token.role
      return session
    },
  },
})
```

### å¯†ç åŠ å¯†å’ŒéªŒè¯

```typescript
// src/lib/password.ts
import * as bcrypt from 'bcryptjs'

export async function hashPassword(password: string): Promise<string> {
  const salt = await bcrypt.genSalt(10)
  return `hashed:${await bcrypt.hash(password, salt)}`
}

export async function verifyPassword(password: string, hashedPassword: string): Promise<boolean> {
  if (!hashedPassword.startsWith('hashed:')) return false
  const hash = hashedPassword.replace('hashed:', '')
  return await bcrypt.compare(password, hash)
}

export function validatePassword(password: string): { valid: boolean; errors: string[] } {
  const errors: string[] = []
  
  if (password.length < 6) errors.push('å¯†ç é•¿åº¦è‡³å°‘ä¸º6ä½')
  if (!/[A-Z]/.test(password)) errors.push('å¯†ç è‡³å°‘åŒ…å«ä¸€ä¸ªå¤§å†™å­—æ¯')
  if (!/[a-z]/.test(password)) errors.push('å¯†ç è‡³å°‘åŒ…å«ä¸€ä¸ªå°å†™å­—æ¯')
  if (!/[0-9]/.test(password)) errors.push('å¯†ç è‡³å°‘åŒ…å«ä¸€ä¸ªæ•°å­—')
  
  return { valid: errors.length === 0, errors }
}
```

### ä¼˜åŒ–ç‰ˆåŒæ­¥è§¦å‘å™¨

```typescript
// src/optimized-sync-trigger.ts
export class OptimizedBidirectionalSyncTrigger extends EventEmitter {
  private chunkProcessor: ChunkProcessor
  private contentCache: MultiLevelCache<string>
  private syncTaskManager: ConcurrentTaskManager<FileChangeEvent, SyncResult>

  constructor(configPath: string = '.doc-code-mapping.json') {
    super()
    
    this.chunkProcessor = new ChunkProcessor({
      chunkSize: 1024 * 1024,
      onProgress: (progress) => {
        this.emit('progress', { progress, message: 'å¤„ç†æ–‡ä»¶ä¸­...' })
      }
    })

    this.contentCache = new MultiLevelCache<string>(
      { maxSize: 100, ttl: 1800000 },
      { maxSize: 1000, ttl: 3600000 }
    )

    this.syncTaskManager = new ConcurrentTaskManager<FileChangeEvent, SyncResult>(
      './src/workers/sync-worker.js',
      {
        maxWorkers: 4,
        taskTimeout: 30000,
        retryAttempts: 3,
        retryDelay: 1000
      }
    )
  }
}
```

---

## ğŸ“ äº¤ä»˜æ–‡ä»¶æ¸…å•

### ç”¨æˆ·è®¤è¯ç³»ç»Ÿï¼ˆ8ä¸ªæ–‡ä»¶ï¼‰
1. [src/lib/auth.ts](file:///Users/my/yyc3-Portable-Intelligent-AI-System/web-dashboard/src/lib/auth.ts) - NextAuthé…ç½®
2. [src/lib/password.ts](file:///Users/my/yyc3-Portable-Intelligent-AI-System/web-dashboard/src/lib/password.ts) - å¯†ç å·¥å…·å‡½æ•°
3. [src/types/next-auth.d.ts](file:///Users/my/yyc3-Portable-Intelligent-AI-System/web-dashboard/src/types/next-auth.d.ts) - TypeScriptç±»å‹å®šä¹‰
4. [src/components/auth-provider.tsx](file:///Users/my/yyc3-Portable-Intelligent-AI-System/web-dashboard/src/components/auth-provider.tsx) - Session Provider
5. [src/app/auth/signin/page.tsx](file:///Users/my/yyc3-Portable-Intelligent-AI-System/web-dashboard/src/app/auth/signin/page.tsx) - ç™»å½•é¡µé¢
6. [src/app/auth/signup/page.tsx](file:///Users/my/yyc3-Portable-Intelligent-AI-System/web-dashboard/src/app/auth/signup/page.tsx) - æ³¨å†Œé¡µé¢
7. [src/app/api/auth/[...nextauth]/route.ts](file:///Users/my/yyc3-Portable-Intelligent-AI-System/web-dashboard/src/app/api/auth/[...nextauth]/route.ts) - NextAuth API
8. [src/app/api/auth/signup/route.ts](file:///Users/my/yyc3-Portable-Intelligent-AI-System/web-dashboard/src/app/api/auth/signup/route.ts) - æ³¨å†ŒAPI

### ä¼˜åŒ–ç‰ˆåŒæ­¥è§¦å‘å™¨é›†æˆï¼ˆ5ä¸ªæ–‡ä»¶ï¼‰
1. [src/index.ts](file:///Users/my/yyc3-Portable-Intelligent-AI-System/tools/doc-code-sync/src/index.ts) - ä¸»ç¨‹åºï¼ˆå·²æ›´æ–°ï¼‰
2. [src/chunk-processor.ts](file:///Users/my/yyc3-Portable-Intelligent-AI-System/tools/doc-code-sync/src/chunk-processor.ts) - åˆ†å—å¤„ç†å™¨
3. [src/cache-manager.ts](file:///Users/my/yyc3-Portable-Intelligent-AI-System/tools/doc-code-sync/src/cache-manager.ts) - ç¼“å­˜ç®¡ç†å™¨
4. [src/concurrent-manager.ts](file:///Users/my/yyc3-Portable-Intelligent-AI-System/tools/doc-code-sync/src/concurrent-manager.ts) - å¹¶å‘ä»»åŠ¡ç®¡ç†å™¨
5. [src/optimized-sync-trigger.ts](file:///Users/my/yyc3-Portable-Intelligent-AI-System/tools/doc-code-sync/src/optimized-sync-trigger.ts) - ä¼˜åŒ–ç‰ˆåŒæ­¥è§¦å‘å™¨

### æ›´æ–°çš„æ–‡ä»¶ï¼ˆ2ä¸ªæ–‡ä»¶ï¼‰
1. [src/components/sidebar.tsx](file:///Users/my/yyc3-Portable-Intelligent-AI-System/web-dashboard/src/components/sidebar.tsx) - ä¾§è¾¹æ ï¼ˆå·²æ›´æ–°ï¼‰
2. [src/app/layout.tsx](file:///Users/my/yyc3-Portable-Intelligent-AI-System/web-dashboard/src/app/layout.tsx) - æ ¹å¸ƒå±€ï¼ˆå·²æ›´æ–°ï¼‰

---

## ğŸ¯ ä¸‹ä¸€æ­¥å·¥ä½œ

### ä¼˜å…ˆçº§2ï¼ˆä¸­ï¼‰
- [ ] å®ç°æƒé™ç®¡ç†ç³»ç»Ÿ
- [ ] å®ç°æ˜ å°„è§„åˆ™ç®¡ç†é¡µé¢

### ä¼˜å…ˆçº§3ï¼ˆä½ï¼‰
- [ ] å®ç°Workerè„šæœ¬
- [ ] è¿›è¡Œæ€§èƒ½æµ‹è¯•éªŒè¯

---

## âœ… æ€»ç»“

æœ¬æ¬¡å·¥ä½œå®Œæˆäº†ä¼˜å…ˆçº§1ï¼ˆé«˜ï¼‰çš„æ‰€æœ‰ä»»åŠ¡ï¼š

**ç”¨æˆ·è®¤è¯ç³»ç»Ÿ**:
- âœ… NextAuth.jsé›†æˆå’Œé…ç½®
- âœ… ç™»å½•é¡µé¢å®ç°
- âœ… æ³¨å†Œé¡µé¢å®ç°
- âœ… å¯†ç åŠ å¯†å’ŒéªŒè¯
- âœ… APIè·¯ç”±å®ç°
- âœ… ä¾§è¾¹æ é›†æˆ

**ä¼˜åŒ–ç‰ˆåŒæ­¥è§¦å‘å™¨é›†æˆ**:
- âœ… ä¸»ç¨‹åºé›†æˆ
- âœ… å‘½ä»¤è¡Œé€‰é¡¹æ·»åŠ 
- âœ… ç±»å‹é”™è¯¯ä¿®å¤
- âœ… ç¼–è¯‘æˆåŠŸ

**æŠ€æœ¯äº®ç‚¹**:
- ä½¿ç”¨bcryptjsè¿›è¡Œå¯†ç åŠ å¯†
- å®ç°JWTä¼šè¯ç­–ç•¥
- é›†æˆPrisma Adapter
- æ”¯æŒä¼˜åŒ–ç‰ˆå’Œæ ‡å‡†ç‰ˆè§¦å‘å™¨åˆ‡æ¢
- å®Œæ•´çš„ç±»å‹å®‰å…¨

æ‰€æœ‰ä»£ç å·²ç¼–è¯‘æˆåŠŸï¼Œå¯ä»¥è¿›è¡Œä¸‹ä¸€æ­¥å¼€å‘å’Œæµ‹è¯•å·¥ä½œï¼ğŸŒ¹

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2026-01-20  
**æŠ¥å‘Šäººå‘˜**: YYCÂ³ AI Team  
**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
