# YYCÂ³ æ–‡æ¡£åŒæ­¥å·¥å…· - ä¼˜å…ˆçº§2ä»»åŠ¡å®ŒæˆæŠ¥å‘Š

## ğŸ“‹ å·¥ä½œæ¦‚è§ˆ

**å·¥ä½œæ—¥æœŸ**: 2026-01-20  
**å·¥ä½œå†…å®¹**: æƒé™ç®¡ç†ç³»ç»Ÿå®ç°ä¸æ˜ å°„è§„åˆ™ç®¡ç†é¡µé¢å¼€å‘  
**æ‰§è¡Œäººå‘˜**: YYCÂ³ AI Team  
**å·¥ä½œçŠ¶æ€**: âœ… ä¼˜å…ˆçº§2ä»»åŠ¡å·²å…¨éƒ¨å®Œæˆ

---

## ğŸ¯ å®Œæˆä»»åŠ¡

### ä¸€ã€æƒé™ç®¡ç†ç³»ç»Ÿå®ç° âœ…

#### 1.1 æƒé™ç±»å‹å®šä¹‰ âœ…

**å®Œæˆå†…å®¹**:
- å®šä¹‰æƒé™æšä¸¾ï¼ˆPermissionï¼‰
- å®šä¹‰è§’è‰²æšä¸¾ï¼ˆRoleï¼‰
- å®šä¹‰è§’è‰²-æƒé™æ˜ å°„å…³ç³»
- å®šä¹‰ç”¨æˆ·æƒé™æ¥å£
- å®šä¹‰æƒé™æ£€æŸ¥ç»“æœæ¥å£

**äº¤ä»˜æˆæœ**:
- [src/types/permissions.ts](file:///Users/my/yyc3-Portable-Intelligent-AI-System/web-dashboard/src/types/permissions.ts) - æƒé™ç±»å‹å®šä¹‰

**æ ¸å¿ƒæƒé™**:
```typescript
export enum Permission {
  MAPPING_READ = 'mapping:read',
  MAPPING_WRITE = 'mapping:write',
  MAPPING_DELETE = 'mapping:delete',
  SYNC_READ = 'sync:read',
  SYNC_EXECUTE = 'sync:execute',
  SYNC_MANAGE = 'sync:manage',
  ALERT_READ = 'alert:read',
  ALERT_MANAGE = 'alert:manage',
  USER_READ = 'user:read',
  USER_WRITE = 'user:write',
  USER_DELETE = 'user:delete',
  SETTINGS_READ = 'settings:read',
  SETTINGS_WRITE = 'settings:write',
  ADMIN = 'admin',
}
```

**è§’è‰²å®šä¹‰**:
- ADMINï¼ˆç®¡ç†å‘˜ï¼‰ï¼šæ‹¥æœ‰æ‰€æœ‰æƒé™
- MODERATORï¼ˆç‰ˆä¸»ï¼‰ï¼šæ‹¥æœ‰æ˜ å°„ã€åŒæ­¥ã€å‘Šè­¦ã€ç”¨æˆ·ã€è®¾ç½®çš„éƒ¨åˆ†æƒé™
- USERï¼ˆç”¨æˆ·ï¼‰ï¼šæ‹¥æœ‰æŸ¥çœ‹æ˜ å°„ã€åŒæ­¥ã€å‘Šè­¦çš„æƒé™
- GUESTï¼ˆè®¿å®¢ï¼‰ï¼šä»…æ‹¥æœ‰æŸ¥çœ‹æ˜ å°„çš„æƒé™

#### 1.2 æƒé™ç®¡ç†å™¨ âœ…

**å®Œæˆå†…å®¹**:
- å®ç°PermissionManagerå•ä¾‹ç±»
- å®ç°æƒé™æ£€æŸ¥æ–¹æ³•
- å®ç°è§’è‰²æƒé™è·å–
- å®ç°ç”¨æˆ·æƒé™åˆ›å»º
- å®ç°è‡ªå®šä¹‰æƒé™ç®¡ç†
- å®ç°è§’è‰²å‡çº§
- å®ç°è·¯ç”±è®¿é—®æ§åˆ¶

**äº¤ä»˜æˆæœ**:
- [src/lib/permissions.ts](file:///Users/my/yyc3-Portable-Intelligent-AI-System/web-dashboard/src/lib/permissions.ts) - æƒé™ç®¡ç†å™¨

**æ ¸å¿ƒæ–¹æ³•**:
```typescript
class PermissionManager {
  hasPermission(userPermissions, permission): boolean
  hasAnyPermission(userPermissions, requiredPermissions): boolean
  hasAllPermissions(userPermissions, requiredPermissions): boolean
  checkPermission(userPermissions, permission): PermissionCheckResult
  getRolePermissions(role): Permission[]
  createUserPermissions(userId, role, customPermissions?): UserPermissions
  addCustomPermission(userPermissions, permission): UserPermissions
  removeCustomPermission(userPermissions, permission): UserPermissions
  upgradeRole(userPermissions, newRole): UserPermissions
  canAccessRoute(userPermissions, route): boolean
}
```

#### 1.3 æƒé™Hook âœ…

**å®Œæˆå†…å®¹**:
- å®ç°usePermissions Hook
- é›†æˆNextAuth.js Session
- æä¾›æƒé™æ£€æŸ¥æ–¹æ³•
- æä¾›è§’è‰²åˆ¤æ–­æ–¹æ³•

**äº¤ä»˜æˆæœ**:
- [src/hooks/use-permissions.ts](file:///Users/my/yyc3-Portable-Intelligent-AI-System/web-dashboard/src/hooks/use-permissions.ts) - æƒé™Hook

**Hook API**:
```typescript
const {
  hasPermission,
  hasAnyPermission,
  hasAllPermissions,
  canAccessRoute,
  isAdmin,
  isModerator,
  isUser,
  isLoading,
  isAuthenticated,
  userPermissions,
} = usePermissions()
```

#### 1.4 æƒé™å®ˆå«ç»„ä»¶ âœ…

**å®Œæˆå†…å®¹**:
- å®ç°PermissionGuardç»„ä»¶
- å®ç°withPermissioné«˜é˜¶ç»„ä»¶
- æ”¯æŒå•ä¸ªæˆ–å¤šä¸ªæƒé™æ£€æŸ¥
- æ”¯æŒå…¨éƒ¨æƒé™æˆ–ä»»æ„æƒé™æ¨¡å¼
- æ”¯æŒè‡ªå®šä¹‰fallback
- æ”¯æŒè‡ªåŠ¨é‡å®šå‘

**äº¤ä»˜æˆæœ**:
- [src/components/permission-guard.tsx](file:///Users/my/yyc3-Portable-Intelligent-AI-System/web-dashboard/src/components/permission-guard.tsx) - æƒé™å®ˆå«ç»„ä»¶

**ä½¿ç”¨ç¤ºä¾‹**:
```tsx
<PermissionGuard permissions={[Permission.MAPPING_WRITE]}>
  <Button>åˆ›å»ºæ˜ å°„</Button>
</PermissionGuard>

<PermissionGuard 
  permissions={[Permission.ADMIN, Permission.MANAGER]} 
  requireAll={false}
>
  <AdminPanel />
</PermissionGuard>
```

#### 1.5 ç”¨æˆ·ç®¡ç†é¡µé¢ âœ…

**å®Œæˆå†…å®¹**:
- åˆ›å»ºç”¨æˆ·ç®¡ç†é¡µé¢
- å®ç°ç”¨æˆ·åˆ—è¡¨å±•ç¤º
- å®ç°ç”¨æˆ·æœç´¢åŠŸèƒ½
- å®ç°ç”¨æˆ·ç¼–è¾‘åŠŸèƒ½
- å®ç°è§’è‰²åˆ†é…
- å®ç°è‡ªå®šä¹‰æƒé™é…ç½®
- é›†æˆæƒé™å®ˆå«

**äº¤ä»˜æˆæœ**:
- [src/app/users/page.tsx](file:///Users/my/yyc3-Portable-Intelligent-AI-System/web-dashboard/src/app/users/page.tsx) - ç”¨æˆ·ç®¡ç†é¡µé¢

**UIç‰¹æ€§**:
- ç”¨æˆ·åˆ—è¡¨å±•ç¤ºï¼ˆå¤´åƒã€åç§°ã€é‚®ç®±ã€è§’è‰²ï¼‰
- æœç´¢åŠŸèƒ½ï¼ˆæŒ‰åç§°æˆ–é‚®ç®±æœç´¢ï¼‰
- ç”¨æˆ·ç¼–è¾‘å¼¹çª—
- è§’è‰²é€‰æ‹©ä¸‹æ‹‰æ¡†
- è‡ªå®šä¹‰æƒé™å¤é€‰æ¡†
- æƒé™æ ‡ç­¾æ˜¾ç¤º
- æ“ä½œæŒ‰é’®ï¼ˆç¼–è¾‘ã€ä¿å­˜ã€å–æ¶ˆï¼‰

#### 1.6 UIç»„ä»¶è¡¥å…… âœ…

**å®Œæˆå†…å®¹**:
- åˆ›å»ºLabelç»„ä»¶
- åˆ›å»ºSelectç»„ä»¶
- åˆ›å»ºBadgeç»„ä»¶

**äº¤ä»˜æˆæœ**:
- [src/components/ui/label.tsx](file:///Users/my/yyc3-Portable-Intelligent-AI-System/web-dashboard/src/components/ui/label.tsx) - Labelç»„ä»¶
- [src/components/ui/select.tsx](file:///Users/my/yyc3-Portable-Intelligent-AI-System/web-dashboard/src/components/ui/select.tsx) - Selectç»„ä»¶
- [src/components/ui/badge.tsx](file:///Users/my/yyc3-Portable-Intelligent-AI-System/web-dashboard/src/components/ui/badge.tsx) - Badgeç»„ä»¶

---

### äºŒã€æ˜ å°„è§„åˆ™ç®¡ç†é¡µé¢ âœ…

#### 2.1 é¡µé¢å®ç° âœ…

**å®Œæˆå†…å®¹**:
- åˆ›å»ºæ˜ å°„è§„åˆ™ç®¡ç†é¡µé¢
- å®ç°æ˜ å°„è§„åˆ™åˆ—è¡¨å±•ç¤º
- å®ç°æ˜ å°„è§„åˆ™æœç´¢åŠŸèƒ½
- å®ç°æ˜ å°„è§„åˆ™çŠ¶æ€æ˜¾ç¤º
- å®ç°åŒæ­¥å¼€å…³æ§åˆ¶
- å®ç°åŒæ­¥æ‰§è¡ŒåŠŸèƒ½
- é›†æˆæƒé™å®ˆå«

**äº¤ä»˜æˆæœ**:
- [src/app/mappings/page.tsx](file:///Users/my/yyc3-Portable-Intelligent-AI-System/web-dashboard/src/app/mappings/page.tsx) - æ˜ å°„è§„åˆ™ç®¡ç†é¡µé¢

**é¡µé¢åŠŸèƒ½**:
- æ˜ å°„è§„åˆ™åˆ—è¡¨ï¼ˆåç§°ã€æ–‡æ¡£è·¯å¾„ã€ä»£ç æ–‡ä»¶ï¼‰
- æ˜ å°„ç±»å‹æ˜¾ç¤ºï¼ˆä¸€å¯¹ä¸€ã€ä¸€å¯¹å¤šã€å¤šå¯¹ä¸€ï¼‰
- åŒæ­¥çŠ¶æ€æ˜¾ç¤ºï¼ˆæˆåŠŸã€å¤±è´¥ã€å¾…åŒæ­¥ã€åŒæ­¥ä¸­ï¼‰
- æœ€ååŒæ­¥æ—¶é—´æ˜¾ç¤º
- æœç´¢åŠŸèƒ½ï¼ˆæŒ‰åç§°æˆ–æ–‡æ¡£è·¯å¾„æœç´¢ï¼‰
- åŒæ­¥å¼€å…³ï¼ˆå¯ç”¨/ç¦ç”¨ï¼‰
- åŒæ­¥æ‰§è¡ŒæŒ‰é’®
- ç¼–è¾‘æŒ‰é’®ï¼ˆéœ€è¦MAPPING_WRITEæƒé™ï¼‰
- åˆ é™¤æŒ‰é’®ï¼ˆéœ€è¦MAPPING_DELETEæƒé™ï¼‰

**UIç‰¹æ€§**:
- å“åº”å¼å¸ƒå±€
- å¡ç‰‡å¼è®¾è®¡
- çŠ¶æ€æ ‡ç­¾ï¼ˆä¸åŒé¢œè‰²åŒºåˆ†ï¼‰
- å›¾æ ‡æŒ‰é’®ï¼ˆæœç´¢ã€åˆ›å»ºã€ç¼–è¾‘ã€åˆ é™¤ã€åŒæ­¥ï¼‰
- æ‚¬åœæ•ˆæœ
- è¿‡æ¸¡åŠ¨ç”»

---

## ğŸ“Š æŠ€æœ¯å®ç°ç»†èŠ‚

### æƒé™ç®¡ç†ç³»ç»Ÿæ¶æ„

```
src/types/permissions.ts
    â†“
src/lib/permissions.ts (PermissionManager)
    â†“
src/hooks/use-permissions.ts (usePermissions)
    â†“
src/components/permission-guard.tsx (PermissionGuard)
    â†“
src/app/users/page.tsx (ç”¨æˆ·ç®¡ç†)
src/app/mappings/page.tsx (æ˜ å°„ç®¡ç†)
```

### æƒé™æ£€æŸ¥æµç¨‹

1. **ç”¨æˆ·ç™»å½•** â†’ NextAuth.jsåˆ›å»ºSession
2. **Session Provider** â†’ æä¾›ç”¨æˆ·ä¿¡æ¯åˆ°æ•´ä¸ªåº”ç”¨
3. **usePermissions Hook** â†’ ä»Sessionè·å–ç”¨æˆ·è§’è‰²
4. **PermissionManager** â†’ æ ¹æ®è§’è‰²è·å–æƒé™åˆ—è¡¨
5. **PermissionGuard** â†’ æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æ‹¥æœ‰æ‰€éœ€æƒé™
6. **UIæ¸²æŸ“** â†’ æ ¹æ®æƒé™æ˜¾ç¤º/éšè—åŠŸèƒ½

### è§’è‰²æƒé™çŸ©é˜µ

| åŠŸèƒ½ | ADMIN | MODERATOR | USER | GUEST |
|------|--------|------------|-------|--------|
| æ˜ å°„æŸ¥çœ‹ | âœ… | âœ… | âœ… | âœ… |
| æ˜ å°„ç¼–è¾‘ | âœ… | âœ… | âŒ | âŒ |
| æ˜ å°„åˆ é™¤ | âœ… | âŒ | âŒ | âŒ |
| åŒæ­¥æŸ¥çœ‹ | âœ… | âœ… | âœ… | âŒ |
| åŒæ­¥æ‰§è¡Œ | âœ… | âœ… | âŒ | âŒ |
| åŒæ­¥ç®¡ç† | âœ… | âŒ | âŒ | âŒ |
| å‘Šè­¦æŸ¥çœ‹ | âœ… | âœ… | âœ… | âŒ |
| å‘Šè­¦ç®¡ç† | âœ… | âŒ | âŒ | âŒ |
| ç”¨æˆ·æŸ¥çœ‹ | âœ… | âœ… | âŒ | âŒ |
| ç”¨æˆ·ç¼–è¾‘ | âœ… | âŒ | âŒ | âŒ |
| ç”¨æˆ·åˆ é™¤ | âœ… | âŒ | âŒ | âŒ |
| è®¾ç½®æŸ¥çœ‹ | âœ… | âœ… | âŒ | âŒ |
| è®¾ç½®ç¼–è¾‘ | âœ… | âŒ | âŒ | âŒ |

---

## ğŸ“ äº¤ä»˜æ–‡ä»¶æ¸…å•

### æƒé™ç®¡ç†ç³»ç»Ÿï¼ˆ6ä¸ªæ–‡ä»¶ï¼‰
1. [src/types/permissions.ts](file:///Users/my/yyc3-Portable-Intelligent-AI-System/web-dashboard/src/types/permissions.ts) - æƒé™ç±»å‹å®šä¹‰
2. [src/lib/permissions.ts](file:///Users/myyc3-Portable-Intelligent-AI-System/web-dashboard/src/lib/permissions.ts) - æƒé™ç®¡ç†å™¨
3. [src/hooks/use-permissions.ts](file:///Users/my/yyc3-Portable-Intelligent-AI-System/web-dashboard/src/hooks/use-permissions.ts) - æƒé™Hook
4. [src/components/permission-guard.tsx](file:///Users/my/yyc3-Portable-Intelligent-AI-System/web-dashboard/src/components/permission-guard.tsx) - æƒé™å®ˆå«ç»„ä»¶
5. [src/app/users/page.tsx](file:///Users/my/yyc3-Portable-Intelligent-AI-System/web-dashboard/src/app/users/page.tsx) - ç”¨æˆ·ç®¡ç†é¡µé¢
6. [src/types/user.ts](file:///Users/my/yyc3-Portable-Intelligent-AI-System/web-dashboard/src/types/user.ts) - ç”¨æˆ·ç±»å‹å®šä¹‰

### UIç»„ä»¶ï¼ˆ3ä¸ªæ–‡ä»¶ï¼‰
7. [src/components/ui/label.tsx](file:///Users/my/yyc3-Portable-Intelligent-AI-System/web-dashboard/src/components/ui/label.tsx) - Labelç»„ä»¶
8. [src/components/ui/select.tsx](file:///Users/my/yyc3-Portable-Intelligent-AI-System/web-dashboard/src/components/ui/select.tsx) - Selectç»„ä»¶
9. [src/components/ui/badge.tsx](file:///Users/my/yyc3-Portable-Intelligent-AI-System/web-dashboard/src/components/ui/badge.tsx) - Badgeç»„ä»¶

### æ˜ å°„è§„åˆ™ç®¡ç†ï¼ˆ1ä¸ªæ–‡ä»¶ï¼‰
10. [src/app/mappings/page.tsx](file:///Users/my/yyc3-Portable-Intelligent-AI-System/web-dashboard/src/app/mappings/page.tsx) - æ˜ å°„è§„åˆ™ç®¡ç†é¡µé¢

### é…ç½®æ–‡ä»¶ï¼ˆ2ä¸ªæ–‡ä»¶ï¼‰
11. [.env.example](file:///Users/my/yyc3-Portable-Intelligent-AI-System/web-dashboard/.env.example) - ç¯å¢ƒå˜é‡ç¤ºä¾‹
12. [.env](file:///Users/my/yyc3-Portable-Intelligent-AI-System/web-dashboard/.env) - ç¯å¢ƒå˜é‡é…ç½®

---

## ğŸ¯ ä¸‹ä¸€æ­¥å·¥ä½œ

### ä¼˜å…ˆçº§3ï¼ˆä½ï¼‰
- â³ å®ç°Workerè„šæœ¬
- â³ è¿›è¡Œæ€§èƒ½æµ‹è¯•éªŒè¯

---

## âœ… æ€»ç»“

æœ¬æ¬¡å·¥ä½œå®Œæˆäº†ä¼˜å…ˆçº§2ï¼ˆä¸­ï¼‰çš„æ‰€æœ‰ä»»åŠ¡ï¼š

**æƒé™ç®¡ç†ç³»ç»Ÿ**:
- âœ… æƒé™ç±»å‹å®šä¹‰ï¼ˆPermissionã€Roleï¼‰
- âœ… æƒé™ç®¡ç†å™¨ï¼ˆPermissionManagerï¼‰
- âœ… æƒé™Hookï¼ˆusePermissionsï¼‰
- âœ… æƒé™å®ˆå«ç»„ä»¶ï¼ˆPermissionGuardï¼‰
- âœ… ç”¨æˆ·ç®¡ç†é¡µé¢
- âœ… UIç»„ä»¶è¡¥å……ï¼ˆLabelã€Selectã€Badgeï¼‰

**æ˜ å°„è§„åˆ™ç®¡ç†é¡µé¢**:
- âœ… æ˜ å°„è§„åˆ™åˆ—è¡¨å±•ç¤º
- âœ… æœç´¢åŠŸèƒ½
- âœ… çŠ¶æ€æ˜¾ç¤º
- âœ… åŒæ­¥æ§åˆ¶
- âœ… æƒé™é›†æˆ

**æŠ€æœ¯äº®ç‚¹**:
- å®Œæ•´çš„æƒé™ç®¡ç†ç³»ç»Ÿï¼ˆRBACï¼‰
- çµæ´»çš„æƒé™æ£€æŸ¥æœºåˆ¶
- å£°æ˜å¼æƒé™å®ˆå«ç»„ä»¶
- è§’è‰²æƒé™çŸ©é˜µ
- è·¯ç”±è®¿é—®æ§åˆ¶
- å“åº”å¼UIè®¾è®¡

æ‰€æœ‰ä»£ç å·²å®ç°å®Œæˆï¼Œå¯ä»¥è¿›è¡Œä¸‹ä¸€æ­¥å¼€å‘å’Œæµ‹è¯•å·¥ä½œï¼ğŸŒ¹

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2026-01-20  
**æŠ¥å‘Šäººå‘˜**: YYCÂ³ AI Team  
**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
