# YYCÂ³ æ–‡æ¡£åŒæ­¥å·¥å…· - ç³»ç»Ÿéƒ¨ç½²æ–‡æ¡£

## ğŸ“‹ éƒ¨ç½²æ¦‚è¿°

### éƒ¨ç½²ç›®æ ‡

æœ¬æ–‡æ¡£æä¾›YYCÂ³ æ–‡æ¡£åŒæ­¥å·¥å…·çš„å®Œæ•´éƒ¨ç½²æŒ‡å—ï¼ŒåŒ…æ‹¬ç¯å¢ƒå‡†å¤‡ã€éƒ¨ç½²æµç¨‹ã€é…ç½®è¯´æ˜ã€ç›‘æ§å‘Šè­¦ç­‰å†…å®¹ï¼Œç¡®ä¿ç³»ç»Ÿèƒ½å¤Ÿç¨³å®šã€é«˜æ•ˆåœ°è¿è¡Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ã€‚

### éƒ¨ç½²æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     è´Ÿè½½å‡è¡¡å™¨ (Nginx)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Web Server 1   â”‚      â”‚  Web Server 2   â”‚
â”‚  (Next.js)      â”‚      â”‚  (Next.js)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                         â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PostgreSQL    â”‚      â”‚     Redis       â”‚
â”‚  (ä¸»æ•°æ®åº“)    â”‚      â”‚   (ç¼“å­˜)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ–¥ï¸ ç¯å¢ƒè¦æ±‚

### ç¡¬ä»¶è¦æ±‚

#### æœ€ä½é…ç½®

- **CPU**: 2æ ¸
- **å†…å­˜**: 4GB
- **ç£ç›˜**: 20GB SSD
- **ç½‘ç»œ**: 100Mbps

#### æ¨èé…ç½®

- **CPU**: 4æ ¸+
- **å†…å­˜**: 8GB+
- **ç£ç›˜**: 50GB+ SSD
- **ç½‘ç»œ**: 1Gbps

#### ç”Ÿäº§é…ç½®

- **CPU**: 8æ ¸+
- **å†…å­˜**: 16GB+
- **ç£ç›˜**: 100GB+ SSD
- **ç½‘ç»œ**: 10Gbps

### è½¯ä»¶è¦æ±‚

#### æ“ä½œç³»ç»Ÿ

- **Linux**: Ubuntu 20.04+, CentOS 8+, Debian 11+
- **macOS**: 10.15+
- **Windows**: Server 2019+ï¼ˆä¸æ¨èï¼‰

#### è¿è¡Œæ—¶ç¯å¢ƒ

- **Node.js**: 18.x æˆ– 20.x
- **pnpm**: 8.x æˆ– 9.x
- **Docker**: 20.10+
- **Docker Compose**: 2.0+

#### æ•°æ®åº“

- **PostgreSQL**: 14.x æˆ– 15.x
- **Redis**: 7.x

#### å…¶ä»–å·¥å…·

- **Git**: 2.x
- **Nginx**: 1.20+ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
- **PM2**: 5.xï¼ˆå¯é€‰ï¼Œç”¨äºè¿›ç¨‹ç®¡ç†ï¼‰

---

## ğŸ“¦ éƒ¨ç½²æ–¹å¼

### æ–¹å¼ä¸€ï¼šDockeréƒ¨ç½²ï¼ˆæ¨èï¼‰

#### ä¼˜åŠ¿

- ç¯å¢ƒä¸€è‡´æ€§
- å¿«é€Ÿéƒ¨ç½²
- æ˜“äºæ‰©å±•
- ä¾¿äºç®¡ç†

#### éƒ¨ç½²æ­¥éª¤

**1. å…‹éš†ä»£ç ä»“åº“**

```bash
git clone https://github.com/YYC-Cube/yyc3-PortAISys.git
cd yyc3-PortAISys
```

**2. é…ç½®ç¯å¢ƒå˜é‡**

```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿
cp .env.example .env

# ç¼–è¾‘ç¯å¢ƒå˜é‡
vim .env
```

**.envé…ç½®ç¤ºä¾‹**ï¼š

```env
# åº”ç”¨é…ç½®
NODE_ENV=production
PORT=3000

# æ•°æ®åº“é…ç½®
DATABASE_URL=postgresql://postgres:password@postgres:5432/yyc3_prod

# Redisé…ç½®
REDIS_URL=redis://redis:6379

# NextAuthé…ç½®
NEXTAUTH_SECRET=your-secret-key-here
NEXTAUTH_URL=https://your-domain.com

# æ–‡æ¡£åŒæ­¥å·¥å…·é…ç½®
DOC_CODE_SYNC_PATH=/app/tools/doc-code-sync
DOC_CODE_SYNC_MONITOR_PORT=3100
```

**3. æ„å»ºDockeré•œåƒ**

```bash
# æ„å»ºWeb Dashboardé•œåƒ
cd web-dashboard
docker build -t yyc3-web-dashboard:latest .

# æ„å»ºDoc-Code Syncå·¥å…·é•œåƒ
cd ../tools/doc-code-sync
docker build -t yyc3-doc-code-sync:latest .
```

**4. å¯åŠ¨æœåŠ¡**

```bash
# ä½¿ç”¨Docker Composeå¯åŠ¨æ‰€æœ‰æœåŠ¡
cd ../
docker-compose up -d

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f
```

**5. åˆå§‹åŒ–æ•°æ®åº“**

```bash
# è¿è¡Œæ•°æ®åº“è¿ç§»
docker-compose exec web-dashboard pnpm prisma migrate deploy

# ç”ŸæˆPrisma Client
docker-compose exec web-dashboard pnpm prisma generate

# åˆ›å»ºåˆå§‹ç®¡ç†å‘˜ç”¨æˆ·
docker-compose exec web-dashboard pnpm prisma db seed
```

**6. éªŒè¯éƒ¨ç½²**

```bash
# æ£€æŸ¥æœåŠ¡å¥åº·çŠ¶æ€
curl http://localhost:3000/health

# è®¿é—®Webç•Œé¢
open http://localhost:3000
```

---

### æ–¹å¼äºŒï¼šä¼ ç»Ÿéƒ¨ç½²

#### éƒ¨ç½²æ­¥éª¤

**1. å®‰è£…Node.jså’Œpnpm**

```bash
# å®‰è£…Node.js 18.x
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt-get install -y nodejs

# å®‰è£…pnpm
npm install -g pnpm
```

**2. å®‰è£…PostgreSQL**

```bash
# å®‰è£…PostgreSQL 14
sudo apt-get install postgresql-14 postgresql-contrib-14

# å¯åŠ¨PostgreSQLæœåŠ¡
sudo systemctl start postgresql
sudo systemctl enable postgresql

# åˆ›å»ºæ•°æ®åº“å’Œç”¨æˆ·
sudo -u postgres psql
```

```sql
-- åœ¨PostgreSQLä¸­æ‰§è¡Œ
CREATE USER yyc3_user WITH PASSWORD 'your_password';
CREATE DATABASE yyc3_prod OWNER yyc3_user;
GRANT ALL PRIVILEGES ON DATABASE yyc3_prod TO yyc3_user;
\q
```

**3. å®‰è£…Redis**

```bash
# å®‰è£…Redis
sudo apt-get install redis-server

# å¯åŠ¨RedisæœåŠ¡
sudo systemctl start redis
sudo systemctl enable redis

# é…ç½®Rediså¯†ç 
sudo vim /etc/redis/redis.conf
```

åœ¨redis.confä¸­æ·»åŠ ï¼š

```
requirepass your_redis_password
```

**4. éƒ¨ç½²Web Dashboard**

```bash
# å…‹éš†ä»£ç ä»“åº“
git clone https://github.com/YYC-Cube/yyc3-PortAISys.git
cd yyc3-PortAISys/web-dashboard

# å®‰è£…ä¾èµ–
pnpm install

# é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
vim .env
```

**.envé…ç½®ç¤ºä¾‹**ï¼š

```env
NODE_ENV=production
PORT=3000
DATABASE_URL=postgresql://yyc3_user:your_password@localhost:5432/yyc3_prod
REDIS_URL=redis://:your_redis_password@localhost:6379
NEXTAUTH_SECRET=your-secret-key-here
NEXTAUTH_URL=https://your-domain.com
```

```bash
# æ„å»ºåº”ç”¨
pnpm build

# è¿è¡Œæ•°æ®åº“è¿ç§»
pnpm prisma migrate deploy

# ç”ŸæˆPrisma Client
pnpm prisma generate

# åˆ›å»ºåˆå§‹ç®¡ç†å‘˜ç”¨æˆ·
pnpm prisma db seed

# ä½¿ç”¨PM2å¯åŠ¨åº”ç”¨
pm2 start npm --name "yyc3-web-dashboard" -- start
pm2 save
pm2 startup
```

**5. éƒ¨ç½²Doc-Code Syncå·¥å…·**

```bash
# è¿›å…¥å·¥å…·ç›®å½•
cd ../tools/doc-code-sync

# å®‰è£…ä¾èµ–
pnpm install

# æ„å»ºå·¥å…·
pnpm build

# åˆå§‹åŒ–å·¥å…·
./init.sh

# å¯åŠ¨ç›‘æ§æœåŠ¡
./start-monitor.sh
```

**6. é…ç½®Nginxåå‘ä»£ç†**

```bash
# å®‰è£…Nginx
sudo apt-get install nginx

# åˆ›å»ºNginxé…ç½®
sudo vim /etc/nginx/sites-available/yyc3
```

Nginxé…ç½®ç¤ºä¾‹ï¼š

```nginx
upstream yyc3_backend {
    server 127.0.0.1:3000;
    keepalive 64;
}

server {
    listen 80;
    server_name your-domain.com;

    # é‡å®šå‘åˆ°HTTPS
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name your-domain.com;

    # SSLè¯ä¹¦é…ç½®
    ssl_certificate /etc/letsencrypt/live/your-domain.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/your-domain.com/privkey.pem;
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers HIGH:!aNULL:!MD5;

    # æ—¥å¿—é…ç½®
    access_log /var/log/nginx/yyc3_access.log;
    error_log /var/log/nginx/yyc3_error.log;

    # ä»£ç†é…ç½®
    location / {
        proxy_pass http://yyc3_backend;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }

    # é™æ€æ–‡ä»¶ç¼“å­˜
    location /_next/static {
        proxy_pass http://yyc3_backend;
        proxy_cache_valid 200 60m;
        add_header Cache-Control "public, immutable, max-age=31536000";
    }

    # APIä»£ç†
    location /api {
        proxy_pass http://yyc3_backend;
        proxy_cache_bypass $http_upgrade;
    }
}
```

```bash
# å¯ç”¨ç«™ç‚¹
sudo ln -s /etc/nginx/sites-available/yyc3 /etc/nginx/sites-enabled/

# æµ‹è¯•é…ç½®
sudo nginx -t

# é‡å¯Nginx
sudo systemctl restart nginx
```

**7. é…ç½®SSLè¯ä¹¦**

```bash
# å®‰è£…Certbot
sudo apt-get install certbot python3-certbot-nginx

# è·å–SSLè¯ä¹¦
sudo certbot --nginx -d your-domain.com

# è‡ªåŠ¨ç»­æœŸ
sudo certbot renew --dry-run
```

---

## ğŸ”§ é…ç½®è¯´æ˜

### æ•°æ®åº“é…ç½®

#### PostgreSQLé…ç½®

**postgresql.confä¼˜åŒ–**ï¼š

```ini
# è¿æ¥é…ç½®
max_connections = 200
shared_buffers = 256MB
effective_cache_size = 1GB
maintenance_work_mem = 64MB
checkpoint_completion_target = 0.9
wal_buffers = 16MB
default_statistics_target = 100
random_page_cost = 1.1
effective_io_concurrency = 200
work_mem = 1310kB
min_wal_size = 1GB
max_wal_size = 4GB

# æ—¥å¿—é…ç½®
logging_collector = on
log_directory = 'pg_log'
log_filename = 'postgresql-%Y-%m-%d_%H%M%S.log'
log_statement = 'mod'
log_duration = on
log_line_prefix = '%t [%p]: [%l-1] user=%u,db=%d,app=%a,client=%h '

# æ€§èƒ½ä¼˜åŒ–
shared_preload_libraries = 'pg_stat_statements'
```

#### Redisé…ç½®

**redis.confä¼˜åŒ–**ï¼š

```
# å†…å­˜é…ç½®
maxmemory 2gb
maxmemory-policy allkeys-lru

# æŒä¹…åŒ–é…ç½®
save 900 1
save 300 10
save 60 10000

# å®‰å…¨é…ç½®
requirepass your_redis_password
rename-command FLUSHDB ""
rename-command FLUSHALL ""

# æ€§èƒ½ä¼˜åŒ–
tcp-keepalive 300
tcp-backlog 511
timeout 0
```

### åº”ç”¨é…ç½®

#### Next.jsé…ç½®

**next.config.tsä¼˜åŒ–**ï¼š

```typescript
import type { NextConfig } from 'next';

const nextConfig: NextConfig = {
  // ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–
  swcMinify: true,
  compress: true,
  
  // å›¾ç‰‡ä¼˜åŒ–
  images: {
    formats: ['image/avif', 'image/webp'],
    deviceSizes: [640, 750, 828, 1080, 1200, 1920, 2048, 3840],
    imageSizes: [16, 32, 48, 64, 96, 128, 256, 384],
  },
  
  // ç¯å¢ƒå˜é‡
  env: {
    NEXT_PUBLIC_APP_NAME: 'YYCÂ³ æ–‡æ¡£åŒæ­¥å·¥å…·',
    NEXT_PUBLIC_APP_VERSION: '1.0.0',
  },
  
  // å®éªŒæ€§åŠŸèƒ½
  experimental: {
    serverActions: true,
    optimizeCss: true,
  },
  
  // è¾“å‡ºé…ç½®
  output: 'standalone',
  
  // æ€§èƒ½ä¼˜åŒ–
  reactStrictMode: true,
  
  // å®‰å…¨å¤´
  async headers() {
    return [
      {
        source: '/:path*',
        headers: [
          {
            key: 'X-DNS-Prefetch-Control',
            value: 'on'
          },
          {
            key: 'Strict-Transport-Security',
            value: 'max-age=63072000; includeSubDomains; preload'
          },
          {
            key: 'X-Frame-Options',
            value: 'SAMEORIGIN'
          },
          {
            key: 'X-Content-Type-Options',
            value: 'nosniff'
          },
          {
            key: 'Referrer-Policy',
            value: 'origin-when-cross-origin'
          },
        ],
      },
    ];
  },
};

export default nextConfig;
```

#### Prismaé…ç½®

**schema.prismaä¼˜åŒ–**ï¼š

```prisma
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
  binaryTargets = ["native", "linux-musl-openssl-3.0.x"]
}

// æ•°æ®åº“è¿æ¥æ± 
// åœ¨åº”ç”¨ä»£ç ä¸­é…ç½®
const prisma = new PrismaClient({
  datasources: {
    db: {
      url: process.env.DATABASE_URL,
    },
  },
  log: [
    { level: 'query', emit: 'event' },
    { level: 'error', emit: 'stdout' },
    { level: 'warn', emit: 'stdout' },
  ],
});

// è¿æ¥æ± é…ç½®
const prisma = new PrismaClient({
  datasources: {
    db: {
      url: process.env.DATABASE_URL,
    },
  },
  log: ['query', 'error', 'warn'],
});

// ä½¿ç”¨è¿æ¥æ± 
const prisma = new PrismaClient({
  datasources: {
    db: {
      url: process.env.DATABASE_URL,
    },
  },
  log: ['query', 'error', 'warn'],
});
```

---

## ğŸ“Š ç›‘æ§å’Œå‘Šè­¦

### ç›‘æ§ç³»ç»Ÿ

#### Prometheusé…ç½®

**prometheus.yml**ï¼š

```yaml
global:
  scrape_interval: 15s
  evaluation_interval: 15s

scrape_configs:
  - job_name: 'yyc3-web-dashboard'
    static_configs:
      - targets: ['localhost:3000']
    metrics_path: '/api/metrics'

  - job_name: 'postgres'
    static_configs:
      - targets: ['localhost:9187']

  - job_name: 'redis'
    static_configs:
      - targets: ['localhost:9121']

  - job_name: 'node'
    static_configs:
      - targets: ['localhost:9100']
```

#### Grafanaä»ªè¡¨ç›˜

**æ¨èä»ªè¡¨ç›˜**ï¼š

- Node.js Exporter Full
- PostgreSQL Database
- Redis Dashboard
- Nginx Monitoring

### å‘Šè­¦é…ç½®

**alertmanager.yml**ï¼š

```yaml
global:
  resolve_timeout: 5m

route:
  group_by: ['alertname', 'cluster', 'service']
  group_wait: 10s
  group_interval: 10s
  repeat_interval: 12h
  receiver: 'default'

  routes:
    - match:
        severity: critical
      receiver: 'pagerduty'
    
    - match:
        severity: warning
      receiver: 'email'

receivers:
  - name: 'default'
    email_configs:
      - to: 'alerts@example.com'
        from: 'prometheus@example.com'
        smarthost: 'smtp.gmail.com:587'
        auth_username: 'prometheus@example.com'
        auth_password: 'your-password'

  - name: 'pagerduty'
    pagerduty_configs:
      - service_key: 'your-pagerduty-key'

  - name: 'email'
    email_configs:
      - to: 'alerts@example.com'
        from: 'prometheus@example.com'
        smarthost: 'smtp.gmail.com:587'
        auth_username: 'prometheus@example.com'
        auth_password: 'your-password'
```

**å‘Šè­¦è§„åˆ™**ï¼š

```yaml
groups:
  - name: yyc3_alerts
    rules:
      - alert: HighErrorRate
        expr: rate(http_requests_total{status=~"5.."}[5m]) > 0.05
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: "High error rate detected"
          description: "Error rate is {{ $value }} errors per second"

      - alert: HighResponseTime
        expr: histogram_quantile(0.95, http_request_duration_seconds) > 1
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "High response time detected"
          description: "95th percentile response time is {{ $value }} seconds"

      - alert: DatabaseConnectionPoolExhausted
        expr: pg_stat_activity_count / pg_settings_max_connections > 0.9
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: "Database connection pool exhausted"
          description: "{{ $value | humanizePercentage }} of connections used"

      - alert: RedisMemoryHigh
        expr: redis_memory_used_bytes / redis_memory_max_bytes > 0.9
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "Redis memory usage high"
          description: "{{ $value | humanizePercentage }} of memory used"
```

---

## ğŸ’¾ å¤‡ä»½å’Œæ¢å¤

### æ•°æ®åº“å¤‡ä»½

#### è‡ªåŠ¨å¤‡ä»½è„šæœ¬

**backup.sh**ï¼š

```bash
#!/bin/bash

# é…ç½®
BACKUP_DIR="/var/backups/yyc3"
DATABASE_NAME="yyc3_prod"
DATABASE_USER="yyc3_user"
RETENTION_DAYS=30

# åˆ›å»ºå¤‡ä»½ç›®å½•
mkdir -p $BACKUP_DIR

# å¤‡ä»½æ–‡ä»¶å
BACKUP_FILE="$BACKUP_DIR/yyc3_$(date +%Y%m%d_%H%M%S).sql.gz"

# æ‰§è¡Œå¤‡ä»½
PGPASSWORD=$DATABASE_PASSWORD pg_dump -U $DATABASE_USER -h localhost -d $DATABASE_NAME | gzip > $BACKUP_FILE

# åˆ é™¤æ—§å¤‡ä»½
find $BACKUP_DIR -name "yyc3_*.sql.gz" -mtime +$RETENTION_DAYS -delete

# ä¸Šä¼ åˆ°äº‘å­˜å‚¨ï¼ˆå¯é€‰ï¼‰
# aws s3 cp $BACKUP_FILE s3://your-backup-bucket/yyc3/

echo "Backup completed: $BACKUP_FILE"
```

**è®¾ç½®å®šæ—¶ä»»åŠ¡**ï¼š

```bash
# ç¼–è¾‘crontab
crontab -e

# æ¯å¤©å‡Œæ™¨2ç‚¹æ‰§è¡Œå¤‡ä»½
0 2 * * * /path/to/backup.sh >> /var/log/yyc3_backup.log 2>&1
```

### æ•°æ®åº“æ¢å¤

**æ¢å¤è„šæœ¬**ï¼š

```bash
#!/bin/bash

BACKUP_FILE=$1
DATABASE_NAME="yyc3_prod"
DATABASE_USER="yyc3_user"

# æ£€æŸ¥å¤‡ä»½æ–‡ä»¶
if [ ! -f "$BACKUP_FILE" ]; then
    echo "Backup file not found: $BACKUP_FILE"
    exit 1
fi

# æ¢å¤æ•°æ®åº“
gunzip -c $BACKUP_FILE | PGPASSWORD=$DATABASE_PASSWORD psql -U $DATABASE_USER -h localhost -d $DATABASE_NAME

echo "Restore completed from: $BACKUP_FILE"
```

**ä½¿ç”¨æ–¹æ³•**ï¼š

```bash
./restore.sh /var/backups/yyc3/yyc3_20260120_020000.sql.gz
```

---

## ğŸ” å®‰å…¨åŠ å›º

### ç³»ç»Ÿå®‰å…¨

#### é˜²ç«å¢™é…ç½®

```bash
# å®‰è£…UFW
sudo apt-get install ufw

# é…ç½®é˜²ç«å¢™è§„åˆ™
sudo ufw default deny incoming
sudo ufw default allow outgoing
sudo ufw allow ssh
sudo ufw allow http
sudo ufw allow https
sudo ufw enable
```

#### SSHå®‰å…¨

```bash
# ç¼–è¾‘SSHé…ç½®
sudo vim /etc/ssh/sshd_config

# ç¦ç”¨rootç™»å½•
PermitRootLogin no

# ç¦ç”¨å¯†ç è®¤è¯
PasswordAuthentication no

# é™åˆ¶ç”¨æˆ·
AllowUsers your_username

# é‡å¯SSHæœåŠ¡
sudo systemctl restart sshd
```

### åº”ç”¨å®‰å…¨

#### ç¯å¢ƒå˜é‡ä¿æŠ¤

```bash
# è®¾ç½®ç¯å¢ƒå˜é‡æ–‡ä»¶æƒé™
chmod 600 .env

# ç¡®ä¿ç¯å¢ƒå˜é‡ä¸è¢«æäº¤åˆ°Git
echo ".env" >> .gitignore
```

#### ä¾èµ–å®‰å…¨æ‰«æ

```bash
# æ‰«æä¾èµ–æ¼æ´
npm audit

# ä½¿ç”¨Snykæ‰«æ
npx snyk test

# è‡ªåŠ¨ä¿®å¤
npm audit fix
```

---

## ğŸš€ æ€§èƒ½ä¼˜åŒ–

### åº”ç”¨å±‚ä¼˜åŒ–

#### ç¼“å­˜ç­–ç•¥

```typescript
// Redisç¼“å­˜ç¤ºä¾‹
import Redis from 'ioredis';

const redis = new Redis(process.env.REDIS_URL);

export async function getWithCache<T>(
  key: string,
  fetcher: () => Promise<T>,
  ttl: number = 3600
): Promise<T> {
  // å°è¯•ä»ç¼“å­˜è·å–
  const cached = await redis.get(key);
  if (cached) {
    return JSON.parse(cached);
  }

  // ä»æ•°æ®åº“è·å–
  const data = await fetcher();

  // å­˜å…¥ç¼“å­˜
  await redis.setex(key, ttl, JSON.stringify(data));

  return data;
}
```

#### æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–

```typescript
// ä½¿ç”¨ç´¢å¼•
// åœ¨Prisma schemaä¸­æ·»åŠ ç´¢å¼•
model Mapping {
  id        String   @id @default(cuid())
  name      String
  status    String
  createdAt DateTime @default(now())
  
  @@index([status])
  @@index([createdAt])
}

// æ‰¹é‡æŸ¥è¯¢
const mappings = await prisma.mapping.findMany({
  where: {
    status: 'active',
  },
  select: {
    id: true,
    name: true,
    status: true,
  },
  take: 100,
  skip: 0,
});
```

### ç³»ç»Ÿå±‚ä¼˜åŒ–

#### å†…æ ¸å‚æ•°ä¼˜åŒ–

```bash
# ç¼–è¾‘sysctlé…ç½®
sudo vim /etc/sysctl.conf

# æ·»åŠ ä»¥ä¸‹é…ç½®
net.core.somaxconn = 65535
net.core.netdev_max_backlog = 65535
net.ipv4.tcp_max_syn_backlog = 65535
net.ipv4.tcp_tw_reuse = 1
net.ipv4.tcp_fin_timeout = 30
net.ipv4.tcp_keepalive_time = 1200
vm.swappiness = 10
vm.dirty_ratio = 15
vm.dirty_background_ratio = 5

# åº”ç”¨é…ç½®
sudo sysctl -p
```

#### æ–‡ä»¶æè¿°ç¬¦é™åˆ¶

```bash
# ç¼–è¾‘limitsé…ç½®
sudo vim /etc/security/limits.conf

# æ·»åŠ ä»¥ä¸‹é…ç½®
* soft nofile 65535
* hard nofile 65535
* soft nproc 65535
* hard nproc 65535

# é‡å¯ç³»ç»Ÿç”Ÿæ•ˆ
sudo reboot
```

---

## ğŸ“ è¿ç»´æ‰‹å†Œ

### æ—¥å¸¸ç»´æŠ¤

#### æ—¥å¿—ç®¡ç†

```bash
# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
pm2 logs yyc3-web-dashboard

# æŸ¥çœ‹Nginxæ—¥å¿—
sudo tail -f /var/log/nginx/yyc3_access.log
sudo tail -f /var/log/nginx/yyc3_error.log

# æŸ¥çœ‹PostgreSQLæ—¥å¿—
sudo tail -f /var/log/postgresql/postgresql-14-main.log

# æ—¥å¿—è½®è½¬é…ç½®
sudo vim /etc/logrotate.d/yyc3
```

**logrotateé…ç½®**ï¼š

```
/var/log/yyc3/*.log {
    daily
    rotate 30
    compress
    delaycompress
    missingok
    notifempty
    create 0640 www-data www-data
    sharedscripts
    postrotate
        pm2 reload yyc3-web-dashboard
    endscript
}
```

#### å¥åº·æ£€æŸ¥

```bash
# åº”ç”¨å¥åº·æ£€æŸ¥
curl http://localhost:3000/health

# æ•°æ®åº“å¥åº·æ£€æŸ¥
pg_isready -h localhost -U yyc3_user

# Rediså¥åº·æ£€æŸ¥
redis-cli ping
```

### æ•…éšœæ’æŸ¥

#### å¸¸è§é—®é¢˜

**1. åº”ç”¨æ— æ³•å¯åŠ¨**

```bash
# æ£€æŸ¥PM2çŠ¶æ€
pm2 status

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
pm2 logs yyc3-web-dashboard --err

# æ£€æŸ¥ç«¯å£å ç”¨
sudo lsof -i :3000
```

**2. æ•°æ®åº“è¿æ¥å¤±è´¥**

```bash
# æ£€æŸ¥PostgreSQLçŠ¶æ€
sudo systemctl status postgresql

# æ£€æŸ¥è¿æ¥æ•°
sudo -u postgres psql -c "SELECT count(*) FROM pg_stat_activity;"

# æŸ¥çœ‹æ•°æ®åº“æ—¥å¿—
sudo tail -f /var/log/postgresql/postgresql-14-main.log
```

**3. Redisè¿æ¥å¤±è´¥**

```bash
# æ£€æŸ¥RedisçŠ¶æ€
sudo systemctl status redis

# æµ‹è¯•Redisè¿æ¥
redis-cli -a your_password ping

# æŸ¥çœ‹Redisæ—¥å¿—
sudo tail -f /var/log/redis/redis-server.log
```

**4. æ€§èƒ½é—®é¢˜**

```bash
# æ£€æŸ¥CPUä½¿ç”¨
top

# æ£€æŸ¥å†…å­˜ä½¿ç”¨
free -h

# æ£€æŸ¥ç£ç›˜ä½¿ç”¨
df -h

# æ£€æŸ¥ç½‘ç»œè¿æ¥
netstat -an | grep :3000
```

---

## âœ… éƒ¨ç½²æ£€æŸ¥æ¸…å•

### éƒ¨ç½²å‰æ£€æŸ¥

- [ ] ç¡¬ä»¶èµ„æºæ»¡è¶³è¦æ±‚
- [ ] æ“ä½œç³»ç»Ÿç‰ˆæœ¬ç¬¦åˆè¦æ±‚
- [ ] æ‰€æœ‰ä¾èµ–è½¯ä»¶å·²å®‰è£…
- [ ] ç½‘ç»œé…ç½®æ­£ç¡®
- [ ] é˜²ç«å¢™è§„åˆ™å·²é…ç½®
- [ ] SSLè¯ä¹¦å·²å‡†å¤‡

### éƒ¨ç½²ä¸­æ£€æŸ¥

- [ ] ä»£ç ä»“åº“å·²å…‹éš†
- [ ] ç¯å¢ƒå˜é‡å·²é…ç½®
- [ ] æ•°æ®åº“å·²åˆ›å»º
- [ ] æ•°æ®åº“è¿ç§»å·²æ‰§è¡Œ
- [ ] åˆå§‹æ•°æ®å·²å¯¼å…¥
- [ ] æœåŠ¡å·²å¯åŠ¨

### éƒ¨ç½²åæ£€æŸ¥

- [ ] åº”ç”¨å¯æ­£å¸¸è®¿é—®
- [ ] ç”¨æˆ·è®¤è¯åŠŸèƒ½æ­£å¸¸
- [ ] æ•°æ®åº“è¿æ¥æ­£å¸¸
- [ ] Redisè¿æ¥æ­£å¸¸
- [ ] æ—¥å¿—æ­£å¸¸è¾“å‡º
- [ ] ç›‘æ§æ­£å¸¸å·¥ä½œ
- [ ] å¤‡ä»½æ­£å¸¸æ‰§è¡Œ
- [ ] å‘Šè­¦æ­£å¸¸è§¦å‘

---

## ğŸ“ æ”¯æŒå’Œè”ç³»

### æŠ€æœ¯æ”¯æŒ

- **æ–‡æ¡£**: <https://docs.yyc3.example.com>
- **é—®é¢˜åé¦ˆ**: <https://github.com/YYC-Cube/yyc3-PortAISys/issues>
- **é‚®ä»¶æ”¯æŒ**: <support@yyc3.example.com>

### ç´§æ€¥è”ç³»

- **24/7çƒ­çº¿**: +86-xxx-xxxx-xxxx
- **ç´§æ€¥é‚®ç®±**: <emergency@yyc3.example.com>

---

## ğŸ”„ æ›´æ–°æ—¥å¿—

### v1.0.0 (2026-01-20)

- åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- å®Œæˆæ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½
- é€šè¿‡æ‰€æœ‰æµ‹è¯•
- å‡†å¤‡ç”Ÿäº§éƒ¨ç½²

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**åˆ›å»ºæ—¥æœŸ**: 2026-01-20  
**æœ€åæ›´æ–°**: 2026-01-20  
**æ–‡æ¡£äººå‘˜**: YYCÂ³ AI Team

ç¥éƒ¨ç½²é¡ºåˆ©ï¼ğŸŒ¹
