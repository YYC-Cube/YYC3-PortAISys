# YYC³ 文档同步工具用户操作手册

## 文档信息

**文档名称**: 文档同步工具用户操作手册  
**文档版本**: v1.0  
**创建日期**: 2026-01-20  
**文档状态**: ✅ 已完成  
**维护团队**: YYC³ 产品团队  

---

## 一、快速开始

### 1.1 系统简介

YYC³文档同步工具是一个强大的双向同步系统，可以自动保持文档和代码文件的一致性。通过智能的映射规则和实时监控，确保您的文档和代码始终保持同步。

### 1.2 核心功能

**主要功能**:
- 🔄 双向同步：文档到代码、代码到文档
- 👀 实时监控：自动检测文件变更
- 📊 状态监控：实时查看同步状态
- 🚨 智能告警：异常情况及时通知
- 📝 规则管理：灵活配置映射规则

### 1.3 快速启动

**5分钟快速开始**:
```bash
# 1. 进入工具目录
cd /path/to/doc-code-sync

# 2. 运行初始化
./init.sh

# 3. 启动监控
./start.sh

# 4. 测试同步
echo "# 测试" > docs/test.md

# 5. 查看状态
node dist/index.js status
```

---

## 二、基础操作

### 2.1 初始化系统

#### 2.1.1 首次初始化

**操作步骤**:
1. 打开终端
2. 进入工具目录
3. 运行初始化脚本
4. 按照提示完成配置

**命令示例**:
```bash
cd /Users/my/yyc3-Portable-Intelligent-AI-System/tools/doc-code-sync
./init.sh
```

**预期输出**:
```
🚀 YYC³ 文档与代码双向同步工具 - 初始化
========================================

✅ Node.js 版本检查通过: v20.19.5

📦 正在安装依赖...
✅ 依赖安装完成

🔨 正在构建项目...
✅ 项目构建完成

⚙️  正在初始化配置...
✔ 文档同步配置初始化完成

✅ 已创建 5 个映射规则

📝 配置文件: .doc-code-mapping.json

💡 提示: 运行 'yyc3-doc-sync watch' 开始监控文件变更

✅ 初始化完成！
```

**注意事项**:
- 确保Node.js版本 >= 18.0.0
- 确保有足够的磁盘空间
- 确保有网络连接（用于安装依赖）

#### 2.1.2 重新初始化

**操作步骤**:
1. 备份当前配置
2. 删除配置文件
3. 重新运行初始化

**命令示例**:
```bash
# 备份配置
cp .doc-code-mapping.json .doc-code-mapping.json.backup

# 删除配置
rm .doc-code-mapping.json

# 重新初始化
./init.sh
```

### 2.2 启动监控服务

#### 2.2.1 前台启动

**操作步骤**:
1. 打开终端
2. 进入工具目录
3. 运行启动脚本
4. 观察监控输出

**命令示例**:
```bash
cd /Users/my/yyc3-Portable-Intelligent-AI-System/tools/doc-code-sync
./start.sh
```

**预期输出**:
```
🚀 YYC³ 文档与代码双向同步工具
================================

✅ Node.js 版本检查通过: v20.19.5

👀 正在启动文件监控...
按 Ctrl+C 停止监控
```

#### 2.2.2 后台启动

**操作步骤**:
1. 打开终端
2. 使用nohup启动
3. 输出重定向到日志
4. 保存进程PID

**命令示例**:
```bash
cd /Users/my/yyc3-Portable-Intelligent-AI-System/tools/doc-code-sync
nohup ./start.sh > logs/monitor.log 2>&1 &
echo $! > .monitor.pid
```

**注意事项**:
- 后台启动后可以关闭终端
- 使用日志文件查看输出
- 使用PID文件管理进程

### 2.3 停止监控服务

#### 2.3.1 前台停止

**操作步骤**:
1. 在运行监控的终端中
2. 按Ctrl+C
3. 确认服务已停止

**快捷键**: `Ctrl + C`

#### 2.3.2 后台停止

**操作步骤**:
1. 打开终端
2. 读取PID文件
3. 终止进程
4. 删除PID文件

**命令示例**:
```bash
# 读取PID
MONITOR_PID=$(cat .monitor.pid)

# 终止进程
kill $MONITOR_PID

# 删除PID文件
rm .monitor.pid
```

---

## 三、映射规则管理

### 3.1 查看映射规则

#### 3.1.1 查看所有规则

**操作步骤**:
1. 打开配置文件
2. 查看映射规则列表

**命令示例**:
```bash
cat .doc-code-mapping.json
```

**输出示例**:
```json
{
  "version": "1.0",
  "mappings": [
    {
      "id": "mapping-001",
      "document": "docs/example.md",
      "codeFiles": ["core/example.ts"],
      "type": "one-to-one",
      "syncEnabled": true,
      "syncStatus": "pending"
    }
  ],
  "globalSettings": {
    "autoSync": true,
    "syncInterval": 300,
    "conflictResolution": "manual",
    "notificationEnabled": true
  }
}
```

### 3.2 添加映射规则

#### 3.2.1 手动添加规则

**操作步骤**:
1. 打开配置文件
2. 添加新的映射规则
3. 保存配置文件
4. 重启监控服务

**配置示例**:
```json
{
  "mappings": [
    {
      "id": "mapping-002",
      "document": "docs/new-feature.md",
      "codeFiles": ["core/new-feature.ts"],
      "type": "one-to-one",
      "syncEnabled": true,
      "syncStatus": "pending"
    }
  ]
}
```

#### 3.2.2 使用命令添加

**命令示例**:
```bash
node dist/index.js add-mapping \
  --doc docs/new-feature.md \
  --code core/new-feature.ts \
  --type one-to-one
```

### 3.3 删除映射规则

#### 3.3.1 手动删除规则

**操作步骤**:
1. 打开配置文件
2. 找到要删除的规则
3. 删除规则对象
4. 保存配置文件
5. 重启监控服务

**操作示例**:
```bash
# 编辑配置文件
vim .doc-code-mapping.json

# 删除映射规则
# {
#   "id": "mapping-001",
#   ...
# }

# 保存并退出
# :wq

# 重启监控
./stop-services.sh
./start.sh
```

#### 3.3.2 使用命令删除

**命令示例**:
```bash
node dist/index.js remove-mapping --id mapping-001
```

### 3.4 更新映射规则

#### 3.4.1 启用/禁用规则

**操作步骤**:
1. 打开配置文件
2. 找到要更新的规则
3. 修改syncEnabled字段
4. 保存配置文件
5. 重启监控服务

**配置示例**:
```json
{
  "id": "mapping-001",
  "document": "docs/example.md",
  "codeFiles": ["core/example.ts"],
  "type": "one-to-one",
  "syncEnabled": false,  // 禁用此规则
  "syncStatus": "disabled"
}
```

#### 3.4.2 修改映射关系

**操作步骤**:
1. 打开配置文件
2. 找到要修改的规则
3. 修改document或codeFiles字段
4. 保存配置文件
5. 重启监控服务

**配置示例**:
```json
{
  "id": "mapping-001",
  "document": "docs/updated.md",  // 修改文档路径
  "codeFiles": ["core/updated.ts", "core/helper.ts"],  // 修改代码文件
  "type": "one-to-many",  // 修改映射类型
  "syncEnabled": true,
  "syncStatus": "pending"
}
```

---

## 四、同步操作

### 4.1 手动同步

#### 4.1.1 同步单个文件

**操作步骤**:
1. 确保监控服务运行
2. 执行同步命令
3. 指定要同步的文件
4. 等待同步完成

**命令示例**:
```bash
# 同步文档文件
node dist/index.js sync docs/example.md

# 同步代码文件
node dist/index.js sync core/example.ts
```

**预期输出**:
```
✖ 正在同步: docs/example.md
✅ 同步完成: 1 个映射
```

#### 4.1.2 同步所有文件

**操作步骤**:
1. 确保监控服务运行
2. 执行同步命令
3. 不指定文件参数
4. 等待同步完成

**命令示例**:
```bash
node dist/index.js sync
```

### 4.2 查看同步状态

#### 4.2.1 查看总体状态

**操作步骤**:
1. 打开终端
2. 执行状态命令
3. 查看状态信息

**命令示例**:
```bash
node dist/index.js status
```

**预期输出**:
```
📊 同步状态

总映射数: 5
已同步: 3
失败: 0
待同步: 2

⏳ 待同步的映射:
   - mapping-003
   - mapping-004
```

#### 4.2.2 查看详细状态

**操作步骤**:
1. 打开配置文件
2. 查看每个映射的syncStatus字段
3. 分析同步状态

**状态说明**:
- `pending`: 待同步
- `syncing`: 同步中
- `success`: 同步成功
- `failed`: 同步失败
- `conflict`: 存在冲突
- `disabled`: 已禁用

### 4.3 处理同步冲突

#### 4.3.1 查看冲突信息

**操作步骤**:
1. 查看同步日志
2. 搜索冲突信息
3. 查看冲突详情

**命令示例**:
```bash
grep "冲突" logs/sync.log
```

#### 4.3.2 解决冲突

**解决策略**:
1. **手动解决**: 手动编辑文件，选择保留的内容
2. **最新优先**: 自动选择最新修改的版本
3. **文档优先**: 保留文档的内容
4. **代码优先**: 保留代码的内容

**配置冲突解决策略**:
```json
{
  "globalSettings": {
    "conflictResolution": "manual"  // manual, latest, document, code
  }
}
```

---

## 五、监控和日志

### 5.1 查看实时日志

#### 5.1.1 监控日志

**操作步骤**:
1. 打开终端
2. 使用tail命令查看日志
3. 使用-f参数实时跟踪

**命令示例**:
```bash
# 查看监控日志
tail -f logs/monitor.log

# 查看告警日志
tail -f logs/alerts.log

# 查看同步日志
tail -f logs/sync.log
```

#### 5.1.2 过滤日志

**操作步骤**:
1. 使用grep过滤日志
2. 指定关键词
3. 查看相关日志

**命令示例**:
```bash
# 查看错误日志
grep ERROR logs/monitor.log

# 查看同步失败日志
grep "失败" logs/sync.log

# 查看特定文件的日志
grep "example.md" logs/sync.log
```

### 5.2 监控仪表板

#### 5.2.1 启动仪表板

**操作步骤**:
1. 打开终端
2. 运行仪表板脚本
3. 等待服务启动
4. 在浏览器中访问

**命令示例**:
```bash
./start-dashboard.sh
```

**访问地址**: http://localhost:3101

#### 5.2.2 仪表板功能

**主要功能**:
- 📊 实时同步状态
- 📈 性能指标图表
- 🚨 告警信息展示
- 📋 历史数据查询
- ⚙️ 配置管理

---

## 六、高级操作

### 6.1 配置管理

#### 6.1.1 全局设置

**配置项说明**:
```json
{
  "globalSettings": {
    "autoSync": true,              // 自动同步
    "syncInterval": 300,           // 同步间隔（秒）
    "conflictResolution": "manual", // 冲突解决策略
    "notificationEnabled": true      // 启用通知
  }
}
```

#### 6.1.2 性能优化

**优化配置**:
```json
{
  "globalSettings": {
    "maxConcurrentSyncs": 50,     // 最大并发同步数
    "batchSize": 100,              // 批量处理大小
    "cacheEnabled": true,           // 启用缓存
    "cacheTTL": 3600              // 缓存过期时间（秒）
  }
}
```

### 6.2 导入导出

#### 6.2.1 导出配置

**操作步骤**:
1. 备份当前配置
2. 导出为JSON文件
3. 保存到安全位置

**命令示例**:
```bash
# 导出配置
cp .doc-code-mapping.json backup/config-$(date +%Y%m%d).json

# 导出为压缩文件
tar -czf backup/config-$(date +%Y%m%d).tar.gz .doc-code-mapping.json
```

#### 6.2.2 导入配置

**操作步骤**:
1. 停止监控服务
2. 备份当前配置
3. 导入新配置
4. 重启监控服务

**命令示例**:
```bash
# 停止服务
./stop-services.sh

# 备份当前配置
cp .doc-code-mapping.json .doc-code-mapping.json.backup

# 导入新配置
cp backup/config-20260120.json .doc-code-mapping.json

# 重启服务
./start.sh
```

---

## 七、故障排除

### 7.1 常见问题

#### 问题1: 监控服务未启动

**症状**: 运行启动脚本后服务未启动

**排查步骤**:
1. 检查端口占用
   ```bash
   lsof -i :3100
   ```

2. 检查进程状态
   ```bash
   ps aux | grep node
   ```

3. 查看错误日志
   ```bash
   cat logs/monitor.log
   ```

**解决方案**:
- 释放占用端口
- 检查Node.js版本
- 重新安装依赖

#### 问题2: 文件未同步

**症状**: 修改文件后未触发同步

**排查步骤**:
1. 检查映射规则
   ```bash
   cat .doc-code-mapping.json
   ```

2. 检查文件权限
   ```bash
   ls -la docs/
   ls -la core/
   ```

3. 检查监控状态
   ```bash
   ps aux | grep "node.*watch"
   ```

**解决方案**:
- 添加映射规则
- 调整文件权限
- 重启监控服务

#### 问题3: 同步失败

**症状**: 同步执行后显示失败

**排查步骤**:
1. 查看同步日志
   ```bash
   cat logs/sync.log
   ```

2. 检查磁盘空间
   ```bash
   df -h
   ```

3. 检查文件内容
   ```bash
   cat docs/example.md
   cat core/example.ts
   ```

**解决方案**:
- 清理磁盘空间
- 修复文件内容
- 检查映射规则

### 7.2 获取帮助

#### 7.2.1 命令行帮助

**操作步骤**:
1. 打开终端
2. 运行帮助命令
3. 查看帮助信息

**命令示例**:
```bash
# 查看主帮助
node dist/index.js --help

# 查看特定命令帮助
node dist/index.js watch --help
node dist/index.js sync --help
node dist/index.js status --help
```

#### 7.2.2 在线文档

**文档地址**:
- 快速启动指南: [QUICKSTART.md](file:///Users/my/yyc3-Portable-Intelligent-AI-System/tools/doc-code-sync/QUICKSTART.md)
- 系统部署文档: [系统部署文档](file:///Users/my/yyc3-Portable-Intelligent-AI-System/docs/YYC3-PortAISys-缺失补全/文档同步工具系统部署文档.md)
- API接口文档: [API接口文档](file:///Users/my/yyc3-Portable-Intelligent-AI-System/docs/YYC3-PortAISys-缺失补全/文档同步工具API接口文档.md)

---

## 八、最佳实践

### 8.1 日常使用

**建议**:
1. 定期查看同步状态
2. 定期备份配置文件
3. 定期清理日志文件
4. 定期检查系统资源
5. 定期更新工具版本

### 8.2 性能优化

**建议**:
1. 合理设置同步间隔
2. 避免频繁修改大文件
3. 使用批量操作
4. 启用缓存机制
5. 优化映射规则

### 8.3 安全建议

**建议**:
1. 定期备份重要数据
2. 设置文件权限
3. 使用版本控制
4. 监控异常访问
5. 及时更新安全补丁

---

## 九、总结

本用户操作手册详细描述了YYC³文档同步工具的使用方法，包括快速开始、基础操作、映射规则管理、同步操作、监控和日志、高级操作、故障排除和最佳实践。

通过按照本手册操作，用户可以快速上手并熟练使用YYC³文档同步工具，提高工作效率。

---

**文档结束**

**签名**: YYC³ 产品团队  
**日期**: 2026-01-20
